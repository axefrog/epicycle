export function makeContextDriver(domDriver) {
  return function(context$) {
    const ctx$ = context$.multicast();
    const view$ = ctx$.filter(c => c.view).map(c => c.view);
    const state$ = ctx$.filter(c => c.state).map(c => c.state);
    const metadata$ = ctx$.filter(c => c.metadata).map(c => c.metadata);

    return {
      DOM: domDriver(view$),
      state$,
      metadata$
    };
  };
}

export function makeClientContextDriver(domDriver) {
  function setTitle(title) {
    document.title = title;
  }

  return function(context$) {
    const contextDriver = makeContextDriver(domDriver);
    const source = contextDriver(context$);

    source.metadata$
      .filter(m => m.title)
      .map(m => m.title)
      .observe(setTitle);

    return source;
  };
}
